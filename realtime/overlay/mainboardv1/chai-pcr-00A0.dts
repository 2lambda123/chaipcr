
/dts-v1/;
/plugin/;

/{
	compatible = "ti,beaglebone", "ti,beaglebone-black";
	part-number = "chai-pcr";
	version = "00A0";

	/* state the resources this cape uses */
	exclusive-use =
		/* the pin header uses */
		//"P9.14",              /* pwm: ehrpwm1A LED backlight defined in LCD device tree*/ 

		//Peltier
		"P8.13",                /* pwm: ehrpwm2B PELTIER 1 - Ouput*/
		"P8.19",                /* pwm: ehrpwm2A PELTIER 2 - Ouput*/
		"P8.09",                /* gpio: PELTIER 1_INA - Ouput*/
		"P8.11",                /* gpio: PELTIER 1_INB - Ouput*/
		"P8.15",                /* gpio: PELTIER 2_INA - Ouput*/
		"P8.17",                /* gpio: PELTIER 2_INB - Ouput*/

		//LED board
		"P8.18",		/* gpio: LED_DIGIPOT_CS - Ouput */
		"P8.12",		/* gpio: LED XLAT/LED_CONTROL_CS - Ouput */
		"P8.10",		/* gpio: BLANK - Ouput */
		"P8.14",		/* gpio: VPRG - Ouput */
		"P8.08",		/* gpio: XERR - Input */
		"P9.29",		/* SPI1: SPI1_SD0 (SOUT from LED BOARD) - Input */
		"P9.30",		/* SPI1: SPI1_SD1 (SIN to LED BOARD) - Ouput */
		"P9.31",		/* SPI1: SPI1_CLK (SCLK to LED BOARD) - Ouput */

		//LTC2444
		"P9.12",		/* gpio: SPI_CS or LTC2444 CS - Output*/
		"P9.41",		/* gpio: SPI_BUSY or LTC2444 busy - Input */
		"P9.21",		/* SPI0: SPI_SD0 (SDO from LTC2444) - Input */
		"P9.18",		/* SPI0: SPI_SD1 (SDI to LED LTC2444) - Ouput */
		"P9.22",		/* SPI0: SPI_CLK (SCLK to LED LTC2444) - Ouput */

		//LIA MUX
		"P9.11",		/* gpio: MUX_CONTROL_PIN0 - Output*/
		"P9.13",		/* gpio: MUX_CONTROL_PIN1 - Output*/
		"P9.15",		/* gpio: MUX_CONTROL_PIN2 - Output*/
		"P9.17",		/* gpio: MUX_CONTROL_PIN3 - Output*/

		//LID
		"P8.26",		/* gpio: lid open/close sense - Input*/
		"P9.16",		/* pwm: EHRPWM1B LID heater PWM - Output*/

		//fan
		"P9.42",		/* pwm: Fan - Output*/
		"P8.07",		/* gpio: Fan RPM - Input*/
	
		/* the hardware IP uses */
		"spi0",			//SPI for LEDboard
		"spi1",			//SPI for LTC2444
		"eCAP2_in_PWM2_out",	//LED board PWM
		"eCAP0_in_PWM0_out",	//Fan PWM
		"ehrpwm1B", 		//LID heater PWM
		"ehrpwm2A",		//Peltier 2 PWM
		"ehrpwm2B";		//Peltier 1 PWM


		
	fragment@0 {
		target = <&am33xx_pinmux>;
		__overlay__ {
			/* peltier PWM pins */
			
			peltier1_pwm_pin: pinmux_peltier1_pwm_pin {
				pinctrl-single,pins = <
					0x024 0x04  /* P8.13 ehrpwm2b, MODE4 */
				>;
			};
			peltier2__pwm_pin: pinmux_peltier2_pwm_pin {
				pinctrl-single,pins = <
					0x020 0x04  /* P8.19 ehrpwm2a, MODE4 */
				>;
			};

			/* end peltier pins */

			/* GPIO pins*/
			qpcr_gpio_pins: pinmux_qpcr_gpio_pins {
				pinctrl-single,pins = <
					0x09c 0x07  /* P8.09 PELTIER 1_INA gpio2_5, OUTPUT_PULLUP | MODE7 */
					0x034 0x07  /* P8.11 PELTIER 1_INB gpio1_13, OUTPUT_PULLUP | MODE7 */
					0x03c 0x07  /* P8.15 PELTIER 2_INA gpio1_15, OUTPUT_PULLUP | MODE7 */
					0x024 0x07  /* P8.17 PELTIER 1_INB gpio0_27, OUTPUT_PULLUP | MODE7 */
				>;
			};
			/* end GPIO pins*/

			/* SPI0 pins*/
			spi0_pins: pinmux_spi0_pins {
				pinctrl-single,pins = <
					0x154 0x30  /* P9.21 spi0_d0, INPUT_PULLUP | MODE0 */
					0x158 0x10  /* P9.18 spi0_d1, OUTPUT_PULLUP | MODE0 */
 					0x150 0x30  /* P9.22 spi0_sclk, INPUT_PULLUP | MODE0 */
				>;
			};

			/* end SPI0 pins */

			/* SPI1 pins*/
			spi1_pins: pinmux_spi1_pins {
				pinctrl-single,pins = <
					0x194 0x33  /* P9.29 spi1_d0, INPUT_PULLUP | MODE3 */
					0x198 0x13  /* P9.30 spi1_d1, OUTPUT_PULLUP | MODE3 */
					0x190 0x33  /* P9.31 spi1_sclk, INPUT_PULLUP | MODE3 */
				>;
			};

			/* end SPI1 pins */

			
		   
		};
	}
	 from am3xx_pwm 
	fragment@1 {
	    target = <&epwmss0>;
	    __overlay__ {
		    status = "okay";
	    };
	};
	
	fragment@2 {
	    target = <&ehrpwm1>;
	    __overlay__ {
		    status = "okay";
	    };
	};

	fragment@3 {
	    target = <&ecap0>;
	    __overlay__ {
		    status = "okay";
	    };
	};

	fragment@4 {
	    target = <&epwmss1>;
	    __overlay__ {
		    status = "okay";
	    };
	};

	fragment@5 {
	    target = <&epwmss2>;
	    __overlay__ {
		    status = "okay";
	    };
	};

	fragment@6 {
	    target = <&ehrpwm2>;
	    __overlay__ {
		    status = "okay";
	    };
	};

	fragment@7 {
	   target = <&ecap2>;
	    __overlay__ {
		    status = "okay";
	    };
	};

	
	fragment@8 {
		target = <&ocp>;
		__overlay__ {
			peltier1_pwm {
			    compatible      = "pwm_test";
			    pwms            = <&ehrpwm2 1 500000 1>;
			    pwm-names       = "PWM_P9_14";
			pinctrl-names       = "default";
			pinctrl-0   = <&peltier1_pwm_pin>;
			    enabled         = <1>;
			    duty            = <0>;
			    status          = "okay";
			};

			peltier2_pwm {
			    compatible      = "pwm_test";
			    pwms            = <&ehrpwm2 2 500000 1>;
			    pwm-names       = "PWM_P9_16";
			pinctrl-names       = "default";
			pinctrl-0   = <&peltier2_pwm_pin>;
			    enabled         = <1>;
			    duty            = <0>;
			    status          = "okay";
			};

		};
	};

	/* SPI0 */
	fragment@10 {
		target = <&spi0>;
		__overlay__ {
			#address-cells = <1>;
			#size-cells = <0>;

			status = "okay";
			pinctrl-names = "default";
			pinctrl-0 = <&spi0_pins>;

			spidev@0 {
				spi-max-frequency = <24000000>;
				reg = <0>;
				compatible = "spidev";
			};
			spidev@1 {
				spi-max-frequency = <24000000>;
				reg = <1>;
				compatible = "spidev";
			};            
		};
	};
	
	/* SPI1 */
	fragment@11 {
		target = <&spi0>;
		__overlay__ {
			#address-cells = <1>;
			#size-cells = <0>;

			status = "okay";
			pinctrl-names = "default";
			pinctrl-0 = <&spi1_pins>;

			spidev@0 {
				spi-max-frequency = <24000000>;
				reg = <0>;
				compatible = "spidev";
			};
			spidev@1 {
				spi-max-frequency = <24000000>;
				reg = <1>;
				compatible = "spidev";
			};            
		};
	};
	/* GPIO */
	fragment@12 {
		target = <&ocp>;
		__overlay__ {
			test_helper: helper {
				compatible = "bone-pinmux-helper";
				pinctrl-names = "default";
				pinctrl-0 = <&qpcr_gpio_pins>;
				status = "okay";
			};
		};
	};
};
